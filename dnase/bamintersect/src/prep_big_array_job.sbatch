#!/bin/bash
set -eu -o pipefail

#SBATCH --job-name=prep_big_array_job

########################################################
## FINAL_OUTDIR is passed in via an sbatch export
########################################################

echo In prep_big_array_job.sbatch

ls -1 ${FINAL_OUTDIR}/bams/*.1.bam > "${FINAL_OUTDIR}/bams/chr_list_1"
ls -1 ${FINAL_OUTDIR}/bams/*.2.bam > "${FINAL_OUTDIR}/bams/chr_list_2"

TEMP_DIR_CL1="${FINAL_OUTDIR}/TEMP_DIR_CL1"
echo TEMP_DIR_CL1 is: ${TEMP_DIR_CL1}
mkdir ${TEMP_DIR_CL1}

## bam1 is a full path to the sorted, single chromosome bam file generated by sort_chrom.sbatch
## BASE1 looks like this (for each chromosome):         chr10.1.bam
## bam2 and BASE2 are similar.  BASE2 looks like this:  chr10_KL568015v1_random.2.bam
while read -r bam1; do
    while read -r bam2; do
        BASE1=${bam1##*/}    ## Get rid of the path before the bam file name.
        BASE2=${bam2##*/} 

        BASE1=${BASE1#*\.}   ## Get rid of the sample name.
        BASE2=${BASE2#*\.} 

        echo ${bam1} ${bam2} "${TEMP_DIR_CL1}/${BASE1}___${BASE2}"  >> "${FINAL_OUTDIR}/bams/array_list"
    done < "${FINAL_OUTDIR}/bams/chr_list_2"
done < "${FINAL_OUTDIR}/bams/chr_list_1"

echo Leaving prep_big_array_job.sbatch

